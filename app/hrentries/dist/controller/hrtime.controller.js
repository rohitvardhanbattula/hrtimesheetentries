sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/core/library","sap/ui/export/library","sap/m/Dialog","sap/m/library","sap/m/Button","sap/m/Text","sap/ui/model/Sorter","sap/ui/model/Filter","sap/m/SearchField","sap/ui/table/Column","sap/m/Column","sap/m/Label","sap/ui/model/type/String","sap/ui/comp/library","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/core/message/Message"],(e,t,a,s,i,r,n,o,l,d,g,u,m,h,c,p,f,v)=>{"use strict";var b,y,w,S,_;var V,T;var D=t.ValueState;var I=[];var C;var E;var x=0;var P=t.MessageType;var M=i.DialogType;var W=i.ButtonType;var F;return e.extend("hrentries.hrentries.controller.hrtime",{onInit(){var e=this;b=this.getOwnerComponent().getModel();w=this.getOwnerComponent().getModel("EmployeeService");S=this.getOwnerComponent().getModel("WbselementService");_=this.getOwnerComponent().getModel("TaskService");e.getView().setModel(w);e.getView().setModel(S,"WbsElement");e.getView().setModel(_,"Tasks")},onFilter:function(){var e=this.getView().byId("id_employee_extid");var t=e.getValue();var a=V;var s=T;this._bindtimesheet(t,a,s)},_bindtimesheet:function(e,t,a){var s=[];var i,r,n,o,l,d;r=this;i=new sap.ui.model.json.JSONModel;o=new sap.ui.model.Filter("PersonWorkAgreementExternalID","EQ",e);s.push(o);if(t&&a){var g=t+"T00:00:00Z";var u=a+"T23:59:59Z";var m=new sap.ui.model.Filter("TimeSheetDate","BT",g,u);s.push(m)}else if(t){var h=t+"T00:00:00Z";var u=t+"T23:59:59Z";var m=new sap.ui.model.Filter("TimeSheetDate","BT",h,u);s.push(m)}var c=new sap.m.BusyDialog({title:"Loading Data",text:"Please wait....."});c.open();b.read("/MyTimesheet",{filters:s,urlParameters:{$top:999999},success:function(e){var t;console.log(e);console.log(e.results);i.setData(e.results);r.getView().setModel(i,"Timesheet");c.close()}.bind(this),error:function(e){console.log(e);c.close()}.bind(this)})},_datediff:function(e,t){const a=1e3*60*60*24;const s=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate());const i=Date.UTC(t.getFullYear(),t.getMonth(),t.getDate());return Math.floor((i-s)/a)},handleDateChange:function(e){var t=this.getView().byId("id_search");var a=[],s=e.getParameter("from"),i=e.getParameter("to"),r=e.getParameter("value"),n=e.getParameter("valid"),o=e.getSource();if(n){o.setValueState(D.None);a=r.split("–");if(a.length>1){V=a[0].trim();T=a[1].trim();var l=this._datediff(s,i);if(l>6){o.setValueState(D.Error);o.setValueStateText("Date Range should be with in 7 days");t.setEnabled(false)}else{o.setValueState(D.None);o.setValueStateText("");t.setEnabled(true)}console.log(l)}else{V=a[0].trim();T=a[0].trim();t.setEnabled(true)}}else{o.setValueState(D.Error);o.setValueStateText("Invalid Date");t.setEnabled(false)}},onEmployeeVH:function(){this._oBasicSearchFieldWithSuggestions=new d;this.pDialogWithSuggestions=this.loadFragment({name:"hrentries.hrentries.view.EmployeeVH"}).then(function(e){var t=e.getFilterBar(),a,s,i,r,o,l,d,u;this._oVHDWithSuggestions=e;this.getView().addDependent(e);e.setRangeKeyFields([{label:"User Name",key:"UserName",type:"string",typeInstance:new h({},{maxLength:10})}]);t.setFilterBarExpanded(false);t.setBasicSearch(this._oBasicSearchFieldWithSuggestions);this._oBasicSearchFieldWithSuggestions.attachSearch(function(){t.search()});e.getTableAsync().then(function(t){if(t.bindRows){t.bindAggregation("rows",{path:"/MyEmployees",events:{dataReceived:function(){e.update()}}});a=new g({label:new m({text:"User Name"}),template:new n({wrapping:false,text:"{UserName}"})});a.data({fieldName:"UserName"});t.addColumn(a);s=new g({label:new m({text:"Employee External Id"}),template:new n({wrapping:false,text:"{PersonWorkAgreementExternalID}"})});s.data({fieldName:"PersonWorkAgreementExternalID"});t.addColumn(s);i=new g({label:new m({text:"Employee Name"}),template:new n({wrapping:false,text:"{PersonFullName}"})});i.data({fieldName:"PersonFullName"});t.addColumn(i);r=new g({label:new m({text:"Employee Worker ID"}),template:new n({wrapping:false,text:"{PersonWorkAgreement}"})});r.data({fieldName:"PersonWorkAgreement"});t.addColumn(r);o=new g({label:new m({text:"Business Partner"}),template:new n({wrapping:false,text:"{BusinessPartner}"})});o.data({fieldName:"BusinessPartner"});t.addColumn(o);l=new g({label:new m({text:"User Id"}),template:new n({wrapping:false,text:"{UserID}"})});l.data({fieldName:"UserID"});t.addColumn(l);d=new g({label:new m({text:"Company Code"}),template:new n({wrapping:false,text:"{CompanyCode}"})});d.data({fieldName:"CompanyCode"});t.addColumn(d);u=new g({label:new m({text:"Cost Center"}),template:new n({wrapping:false,text:"{CostCenter}"})});u.data({fieldName:"CostCenter"});t.addColumn(u)}}.bind(this));e.open()}.bind(this))},onValueHelpEmployeeVHOkPress:function(e){var t=e.getParameter("tokens");if(t.length>0){var a=t[0].getKey();var s=t[0].getAggregation("customData");var i=s[0].getProperty("value");var r=this.byId("id_employee_extid");r.setValue(i.PersonWorkAgreementExternalID);if(E){var n=this.byId("id_add_employee_extid");n.setValue(i.PersonWorkAgreementExternalID);var o=this.byId("id_add_wrkid");var l=this.byId("id_add_wrkid_label");var d=this.byId("id_add_ccode_label");var g=this.byId("id_add_ccode");var u=this.byId("id_add_ccodetext");var m=this.byId("id_add_ccenter_label");var h=this.byId("id_add_ccenter");var c=this.byId("id_add_ccentertext");o.setText(i.PersonWorkAgreement);g.setText(i.CompanyCode);u.setText(i.CompanyCodeName);h.setText(i.CostCenter);c.setText(i.CostCenterDescription);o.setVisible(true);g.setVisible(true);h.setVisible(true);if(i.PersonWorkAgreement){l.setVisible(true)}if(i.CompanyCode){d.setVisible(true);u.setVisible(true)}if(i.CostCenter){m.setVisible(true);c.setVisible(true)}}}this._oVHDWithSuggestions.close()},onValueHelpEmployeeVHCancelPress:function(e){this._oVHDWithSuggestions.close()},onValueHelpEmployeeVHAfterClose:function(e){this._oVHDWithSuggestions.destroy()},onFilterBarWithSuggestionsEmpVHSearch:function(e){var t=this._oBasicSearchFieldWithSuggestions.getValue(),a=e.getParameter("selectionSet"),s=a.reduce(function(e,t){if(t.getValue()){e.push(new l({path:t.getName(),operator:p.Contains,value1:t.getValue()}))}return e},[]);s.push(new l({filters:[new l({path:"PersonFullName",operator:p.Contains,value1:t})],and:false}));this._filterTableWithSuggestions(new l({filters:s,and:true}))},_filterTableWithSuggestions:function(e){var t=this._oVHDWithSuggestions;t.getTableAsync().then(function(a){if(a.bindRows){a.getBinding("rows").filter(e)}if(a.bindItems){a.getBinding("items").filter(e)}t.update()})},onAdd:function(){var e=this;E=this.byId("id_dialogaddentries");y=new sap.ui.model.json.JSONModel;for(C=0;C<=4;C++){var t={};t.Id=C;t.TimesheetDate="";t.TaskType="";t.WBSElemt="";t.RecordedHours="0";t.RecordedQuantity="0";I.push(t)}y.setData(I);e.getView().setModel(y,"Entries");y.refresh(true);if(!E){E=new sap.ui.xmlfragment(this.getView().getId(),"hrentries.hrentries.view.AddEntries",this);this.getView().addDependent(E);E.open()}else{E.open()}},onCloseDialog:function(){var e;e=this;I=[];y.setData(I);e.getView().setModel(y,"Entries");y.refresh(true);this.getView().byId("id_dialogaddentries").close()},onsubmitDialog:function(){var e=this.getView().byId("tableId1");var t=e.getBinding("items");var a=[];a=t.oList;console.log(a);this.getView().byId("id_dialogaddentries").close()},onsaveDialog:function(){var e=this.getView().byId("tableId1");var t=e.getBinding("items");var a=[];a=t.oList;console.log(a);this.getView().byId("id_dialogaddentries").close()},onAddEntry:function(e){var t=this;var a={};C=C+1;a.Id=C;a.TimesheetDate="";a.TaskType="";a.WBSElemt="";a.RecordedHours="0";a.RecordedQuantity="0";I.push(a);y.setData(I);t.getView().setModel(y,"Entries");y.refresh(true)},deleteRow:function(e){var t;t=this;var a=e.getParameter("listItem");var s=a.getCells();var i=s[0].getValue();var r=i*1;const n=I.findIndex(e=>e.Id===r);if(n!==-1){I.splice(n,1);y.setData(I);t.getView().setModel(y,"Entries");y.refresh(true)}var o=this.getView().byId("tableId1");o.removeItem(e.getParameter("listItem"))},taskChange:function(e){var t=this.getView().byId("id_add_entrysave");var a=this.getView().byId("id_add_entry_submit");var s=e.getSource(),i=s.getSelectedKey(),r=s.getValue();if(!i&&r){s.setValueState(D.Error);s.setValueStateText("Please enter a valid Task Type");t.setEnabled(false);a.setEnabled(false)}else{s.setValueState(D.None);t.setEnabled(true);a.setEnabled(true)}},wbsChange:function(e){var t=this.getView().byId("id_add_entrysave");var a=this.getView().byId("id_add_entry_submit");var s=e.getSource(),i=s.getSelectedKey(),r=s.getValue();if(!i&&r){s.setValueState(D.Error);s.setValueStateText("Please enter a valid WBS Element");t.setEnabled(false);a.setEnabled(false)}else{s.setValueState(D.None);t.setEnabled(true);a.setEnabled(true)}},handleDateChangeadd_entries:function(e){var t=this.getView().byId("id_add_entrysave");var a=this.getView().byId("id_add_entry_submit");var s=[],i=e.getParameter("from"),r=e.getParameter("to"),n=e.getParameter("value"),o=e.getParameter("valid"),l=e.getSource();if(o){l.setValueState(D.None);s=n.split("–");if(s.length>1){V=s[0].trim();T=s[1].trim();var d=this._datediff(i,r);if(d>6){l.setValueState(D.Error);l.setValueStateText("Date Range should be with in 7 days");t.setEnabled(false);a.setEnabled(false)}else{l.setValueState(D.None);l.setValueStateText("");t.setEnabled(true);a.setEnabled(true)}}else{V=s[0].trim();T=s[0].trim();t.setEnabled(true);a.setEnabled(true)}}else{l.setValueState(D.Error);l.setValueStateText("Invalid Date");t.setEnabled(false);a.setEnabled(false)}},onsubmitDialog:function(){var e;e=this;F=new sap.m.BusyDialog({title:"Saving",text:"Please wait....."});F.open();var t=[];var a=[];var s=this.byId("id_add_employee_extid");var i=this.byId("id_add_wrkid");var r=this.byId("id_add_ccode");var n=this.byId("id_add_ccenter");var o=this.getView().byId("tableId1");var l=o.getBinding("items");t=l.oList;var d=this.getOwnerComponent().getModel();console.log(t);var g=sap.ui.core.format.DateFormat.getDateInstance({pattern:"yyyy-MM-dd"});var u=this._entriesValidations(t);if(u===false){for(let o=0;o<t.length;o++){var m={};m.CompanyCode=r.getText();m.PersonWorkAgreementExternalID=s.getValue();m.PersonWorkAgreement=i.getText();var h=g.format(t[o].TimesheetDate);m.TimeSheetDate=h+"T00:00:00";m.TimeSheetStatus="30";m.TimeSheetOperation="C";m.TimeSheetIsExecutedInTestRun=false;m.TimeSheetIsReleasedOnSave=true;m.TimeSheetDataFields_RecordedHours=t[o].RecordedHours;m.TimeSheetDataFields_RecordedQuantity=t[o].RecordedHours;m.TimeSheetDataFields_WBSElement=t[o].WBSElemt;m.TimeSheetDataFields_TimeSheetTaskType=t[o].TaskType;m.TimeSheetDataFields_ReceiverPubSecFuncnlArea="YB40";m.TimeSheetDataFields_HoursUnitOfMeasure="H";m.TimeSheetDataFields_TimeSheetTaskComponent="WORK";m.TimeSheetDataFields_ControllingArea="A000";m.TimeSheetDataFields_TimeSheetTaskLevel="NONE";m.TimeSheetDataFields_ReceiverCostCenter=n.getText();a[o]=m;d.create("/MyTimesheet",a[o],{success:function(a,s){x=x+1;if(s.statusCode=="201"){if(t.length==x){e._logmessage()}}}.bind(this),error:function(a){x=x+1;if(t.length==x){e._logmessage();console.log(a)}alert("error")}.bind(this)})}}else{var c=new v({message:"Select User Name to auto fill User ID, Worker External ID,Person Worker Agreement ID, Business Partner ID, Employee Name, Company Code,Cost Center",type:P.Error,target:"/Dummy",processor:this.getView().getModel()});oMsgButton.setIcon("sap-icon://error");oMsgButton.setType("Reject");sap.ui.getCore().getMessageManager().addMessages(c)}},_entriesValidations:function(e){return false},_logmessage:function(){var e=this;this.oLogMessageDialog=new s({type:M.Message,title:"Information",state:D.Information,content:new n({text:"Entries Added Successfully."}),beginButton:new r({type:W.Emphasized,text:"Ok",press:function(){this.oLogMessageDialog.close();F.close()}.bind(this)})});this.oLogMessageDialog.open()}})});
//# sourceMappingURL=hrtime.controller.js.map